# Storyteller 项目任务描述（桌面端 / Electron）

## ADR（架构决策记录）
- 本地编排引擎 + 产物驱动的创作流程：[docs/adr/0001-本地编排与产物驱动架构.md](docs/adr/0001-%E6%9C%AC%E5%9C%B0%E7%BC%96%E6%8E%92%E4%B8%8E%E4%BA%A7%E7%89%A9%E9%A9%B1%E5%8A%A8%E6%9E%B6%E6%9E%84.md)

## PRD
- MVP 与演进路线：[docs/PRD-MVP与演进.md](docs/PRD-MVP%E4%B8%8E%E6%BC%94%E8%BF%9B.md)

## 开发日志
- UI 骨架与技术落地记录：[docs/开发日志.md](docs/%E5%BC%80%E5%8F%91%E6%97%A5%E5%BF%97.md)

## ADR
- Agent 与大模型接入：[docs/adr/0002-Agent与模型接入.md](docs/adr/0002-Agent%E4%B8%8E%E6%A8%A1%E5%9E%8B%E6%8E%A5%E5%85%A5.md)

## 背景
你要做的是一个桌面端创作工具：
- 人类作为“指导者/导演”，通过对话告诉 AI 一个故事设定与意图。
- AI 通过“Agent Chat + 节点工作流（类似 n8n）”协同，调用一系列工作流步骤，逐步产出：
  1) 剧本/分场文本
  2) 分镜（镜头列表、画面描述、镜头参数）
  3) 进一步生成 CG 图与视频（可接入外部生成服务）

产品体验重点：每一步都产出可见的结果（Artifact），用户清楚知道下一步、也能随时回退并指挥 AI 改写某一步。

## 项目目标（MVP）
1. 在 Electron 桌面端提供一个最小可用的创作闭环：输入故事意图 → 运行工作流 → 产出脚本与分镜 → 产物可查看与导出。
2. 同一套工程内同时具备：
   - **节点工作流编辑器**（可视化编排、保存、运行）
   - **Agent Chat 面板**（对话、工具调用、运行日志）

## 关键概念与数据结构（建议）
- **Project**：一个故事项目（元信息、素材、输出物集合）
- **Workflow**：节点图（nodes/edges），可版本化与复用
- **Node**：原子步骤（LLM 生成、格式化、调用外部服务、文件写入等）
- **Run**：一次执行（输入、参数、日志、产出、错误）
- **Artifact**：产物（script/storyboard/image/video 等，带元数据与可追溯来源）

## 功能拆解（迭代顺序）
### 里程碑 0：工程可运行（已初始化骨架）
- Electron 主进程 + 渲染进程最小页面
- 可通过 `yarn dev` 启动应用

### 里程碑 1：项目与对话（Agent Chat）
- 左侧：项目列表 / 当前项目
- 右侧：Chat 面板
  - 输入框、消息流
  - “工具调用/运行日志”折叠区
- 本地存储（最小：JSON 文件或 SQLite 二选一）

### 里程碑 2：节点工作流（n8n-like）最小版
- 节点编辑器（画布、拖拽、连线、节点属性面板）
- 内置 3~5 个基础节点类型（建议）：
  - PromptNode：调用 LLM 生成文本
  - TemplateNode：将上游结果格式化为脚本/分镜结构
  - FileWriteNode：保存为本地文件
  - HttpRequestNode：调用外部服务（未来用于图/视频生成）
  - ManualInputNode：人类确认/补充
- 执行引擎（DAG 拓扑排序、节点状态、失败重试策略最小实现）

### 里程碑 3：脚本与分镜产物
- 统一输出格式：
  - Script：分场、人物、对白、舞台说明
  - Storyboard：镜头列表（shotId、时长、景别、运动、画面描述、旁白/对白、参考图提示词）
- 产物查看器：
  - 文本预览 + 导出（Markdown/JSON）

### 里程碑 4：CG 图与视频（接口预留）
- 将“图/视频生成”抽象为外部 Provider：
  - 输入：提示词、分镜镜头、风格参数、seed 等
  - 输出：URL/文件路径 + 元数据
- UI：镜头级别生成按钮、批量生成、失败重试

## 非目标（当前不做）
- 复杂权限系统、多用户协作
- 云端账号体系与付费
- 大规模素材管理/资产库（后续再扩展）

## 技术约束与建议
- 桌面端：Electron（稳定版 v39.2.7）
- 运行层：主进程负责文件系统/任务调度；渲染进程负责编辑与展示
- 安全：默认启用 `contextIsolation`，通过 `preload` 暴露最小 API

## 验收标准（MVP）
- 能创建项目，输入一段故事意图
- 能在节点工作流中编排并运行“生成脚本 + 生成分镜”的流程
- 产物可在应用内查看，并导出到本地文件
