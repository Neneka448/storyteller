# PRD 第一期开篇（文本 → 图文 → CG 图片）

版本：v0.1
日期：2025-12-13

## 1. 第一期开篇目标
在桌面端（Electron）打通一个可反复迭代的创作闭环：
- 用户用 Chat 作为“总导演”提出故事意图与修改意见
- 系统按步骤（Steps）推进，并在每一步产出可见产物（Artifacts）
- 用户可随时审阅、批注、回退/重做某一步（含局部重做）
- 第一期开篇聚焦：**文本 → 图文/CG（图片）**
- 动画/视频：**不做**，但需保留数据结构与接口预留（用于后续演进）

## 2. 范围（必须做）
### 2.1 项目与数据
- 项目管理：新建/打开/删除
- 本地持久化：Project / Step / Run / Artifact / Version / Event
- 追溯性：每个 Artifact 必须记录来源 stepId、输入摘要、生成参数/提示词摘要、生成时间、版本号

### 2.2 Chat（导演指挥）
- 消息流 + 输入框
- AI 输出必须能引用到具体步骤/镜头（例如：更新“分镜#12”或重做“角色设定图 v3”）
- 支持动作：继续下一步 / 重做当前步 / 回退到某步 / 采纳某版本

### 2.3 Steps（固定步骤链，线性即可）
第一期用固定步骤链（无需节点画布编辑器）：
1) 世界观草案（文本）
2) 角色草案（文本）
3) 大纲（文本）
4) 剧本（文本，按场景）
5) 分镜（表格，镜头列表）
6) 角色设定图（图片，至少 1 张，多版本）
7) 关键帧（图片，至少 3 张，多版本）

每一步需要展示：状态（未开始/生成中/成功/失败）、当前采纳版本、历史版本数量、最后更新时间、失败原因（如有）。

### 2.4 产物查看器（Artifacts Viewer）
- 文本类：Markdown/纯文本预览
- 表格类：分镜镜头列表（可展开看镜头详情）
- 图片类：缩略图列表 + 大图预览 + 版本切换（采纳/回滚）
- 导出：
  - 文本与分镜：Markdown + JSON
  - 图片：导出到本地文件夹（按项目/步骤/版本组织）

### 2.5 版本与回退（第一期的“有意思”核心）
- 同一步多版本保存（建议保留最近 N=10，可配置）
- “采纳版本”概念：采纳某版本为当前版本，不删除其它版本
- 局部重做（第一期最小实现）：
  - 文本：对某一步重做
  - 分镜：支持对“选中镜头”重做（只重做该镜头的描述/提示词），并生成新版本
  - 图片：对选中图片步骤重做，生成新候选版本

## 3. 范围（明确不做）
- 动画/视频生成与剪辑（Animatic/视频合成）
- 复杂节点画布编辑器（n8n-like）
- 账号体系/云同步/团队协作
- 大规模素材库与权限系统

## 4. 用户流程（第一期）
1) 新建项目 → 输入一句故事意图
2) AI（可选）追问澄清 → 生成世界观/角色
3) 用户在 Chat 批注 → AI 更新对应步骤并产生新版本
4) 继续推进：大纲 → 剧本 → 分镜
5) 用户点选分镜镜头并批注（如“更暗、近景、逆光”）→ AI 局部重做该镜头
6) 继续推进：角色设定图 → 关键帧（图片）
7) 用户在图片候选中采纳版本，必要时重做
8) 导出：剧本/分镜/图片

## 5. 验收标准（第一期）
- 端到端：从故事意图 → 剧本 + 分镜 + 图片产出成功
- 版本能力：
  - 任意一步可重做并产生新版本
  - 可切换并采纳旧版本
- 局部重做：至少支持“选中分镜镜头”的局部重做
- 导出：Markdown/JSON + 图片文件导出

## 6. 依赖与接口预留（为后续动画/视频）
虽然第一期不做动画/视频，但需预留：
- Artifact 类型：video（预留）
- Step 类型：animatic / shot-video（预留）
- Provider 抽象：文本生成 provider / 图片生成 provider / 视频生成 provider（后者仅占位）

## 7. 里程碑建议
- M1：项目 + Steps 时间线 + Artifact Viewer（先用 mock 数据）
- M2：Chat + 版本化 + 回退/重做闭环（文本全通）
- M3：分镜镜头级局部重做
- M4：图片步骤接入 provider（角色设定图/关键帧）+ 导出
